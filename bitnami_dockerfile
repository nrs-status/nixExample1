FROM bitnami/pytorch

WORKDIR /workdir

#integrate these to requirements and clean unused requirements eventually
RUN pip install transformers
RUN pip install datasets
RUN pip install tqdm
RUN pip install pytorch_lightning
RUN pip install mlflow
RUN pip install memray
RUN pip install scalene
RUN pip install memory_profiler
RUN pip install guppy3
RUN pip install graphviz
RUN pip install objgraph
RUN pip install ipdb

USER root
RUN apt update
RUN apt upgrade
RUN apt install -y curl
RUN curl -L -o bert.py https://raw.githubusercontent.com/nrs-status/shared/main/bert.py
RUN mkdir data
RUN curl -L -o data/imps.txt https://raw.githubusercontent.com/nrs-status/shared/main/data/imps.txt
RUN curl -L -o data/decls.txt https://raw.githubusercontent.com/nrs-status/shared/main/data/decls.txt



RUN adduser --disabled-password --gecos '' appuser
RUN chown -R appuser:appuser /workdir

RUN mkdir /.cache
RUN chown -R appuser:appuser /.cache

RUN touch /.pdbhistory
RUN chown -R appuser:appuser /.pdbhistory

USER appuser

ENV SENTENCE_TRANSFORMERS_HOME=/workdir/.cache
ENTRYPOINT ["memray", "run", "bert.py"]
